document.addEventListener("DOMContentLoaded",(()=>{let e=["template 1","template 2","template 3"],t=2;tinymce.init({selector:"#editorTemplate",height:400,menubar:!1,plugins:["lists"],toolbar:"insertSelect",setup:function(t){t.ui.registry.addButton("insertSelect",{text:"Insert",onAction:function(){if(0===e.length)return void alert("Список шаблонов пуст. Добавьте хотя бы один шаблон.");const n=`<select class="custom-dropdown">${e.map((e=>`<option value="${e.replace(/"/g,"&quot;")}">${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</option>`)).join("")}</select>`;t.insertContent(n)}}),t.on("init",(()=>{t.setContent("<p>There is some text that user typed manually</p>")}))}});const n=document.querySelector("ul"),l=document.getElementById("editorName"),o=document.getElementById("addTemplate"),r=document.getElementById("removeTemplate");function d(){n.innerHTML="",e.forEach(((e,l)=>{const o=document.createElement("li");o.textContent=e,o.style.cursor="pointer",o.style.userSelect="none",o.style.padding="4px 8px",o.style.border="1px solid transparent",l===t&&(o.style.borderColor="#007bff",o.style.backgroundColor="#d7e9ff"),o.addEventListener("click",(()=>{!function(e){t=e,i(),d()}(l)})),n.appendChild(o)})),i()}function i(){null!==t&&t>=0&&t<e.length?(l.value=e[t],l.disabled=!1):(l.value="",l.disabled=!0)}function c(){const t=tinymce.get("editorTemplate");t&&t.getBody().querySelectorAll("select.custom-dropdown").forEach((t=>{let n=t.value;if(t.innerHTML="",e.forEach((e=>{const n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)})),e.includes(n))t.value=n,t.style.color="";else{t.innerHTML="";const e=document.createElement("option");e.textContent="ERROR",e.style.color="red",t.style.color="red",t.appendChild(e)}}))}l.addEventListener("blur",(function(){null!==t&&t>=0&&t<e.length&&(e[t]=l.value.trim()||"New Option",d(),c())})),l.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),l.blur())})),o.addEventListener("click",(()=>{e.push("New Option"),t=e.length-1,d(),l.focus(),c()})),r.addEventListener("click",(()=>{null!==t&&t>=0&&t<e.length&&(e.splice(t,1),t>=e.length&&(t=e.length-1),d(),c())})),d()}));